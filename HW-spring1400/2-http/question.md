# صورت سوال

در این تمرین می‌خواهیم یک کلاینت http برای ارسال requestهای مختلف با زبان جاوا پیاده‌سازی کنیم. 

بسته سورس را دانلود کرده و به کلاس‌های آن نگاه بیندازید. (از [این](https://s16.picofile.com/file/8427019476/src.zip.html) لینک)
در بسته سورس تعدادی کلاس وجود دارد که توضیح هریک را در ادامه خواهیم دید. آن‌چه شما باید پیاده‌سازی کنید، متد `request` از کلاس `HttpRequest` است. 

### توضیح کلاس‌های بسته‌ی سورس
+ کلاس `HttpException `:
کلاس استثنای شخصی‌سازی‌شده‌ی ما برای گزارش استثناهای مربوط به http است. این استثنا **باید** در زمانی که نتیجه‌ی درخواست `http` ناموفق است (کدی از خانواده‌ی ۴۰۰ یا ۵۰۰ است) پرتاب شود.
+ کلاس `HttpResponse`:
نتیجه‌ی درخواست `http` ما باید به شکل یک آبجکت از این کلاس برگردد. استفاده آن نکته خاصی ندارد به جز اینکه headerها، در واقع یک map از رشته به **لیستی از رشته‌ها**ست. به این دلیل که یک key می‌تواند یه لیست از value ها داشته باشد. 
+ کلاس `HttpRequestMethod `:
یک enum است که متدهای مختلف http را represent می‌کند. در مورد متدها، نکته خاصی برای ارسال وجود ندارد. فقط در نظر داشته باشید که در صورتی از متد `GET` استفاده شود، هیچ بدنه‌ای قرار نیست ارسال شود. پس حتی در صورت تنظیم body یا setBody، نباید هیچ body‌ای برای `HttpRequest` تنظیم شود. این موضوع در تست‌ها بررسی خواهد شد.
+ کلاس `HttpRequest `:
پیاده‌سازی این کلاس به شکل ناقص به شما داده می‌شود، شما می‌توانید این کلاس را تغییر دهید. هدف ما، پیاده سازی متد `request` است. این متد بر اساس وضعیت فعلی (اعم از body و params و url و ..) درخواست http ارسال می‌کند. نهایتا نتیجه را به شکل `HttpResponse` برمیگرداند.

مجددا لازم است تکرار شود که در صورتی که نتیجه درخواست، استاتوس سری ۴۰۰ یا ۵۰۰ داشت، باید استثنای `HttpException` با پیام دلخواه و response دریافت شده (یعنی فیلد‌های response باید تنظیم شده باشد) پرتاب شود. 

به جز متد Request که باید پیاده‌سازی کنید، می‌توانید باقی متدها را نیز تغییر دهید (مثلا سازنده و set body را با توجه به اینکه متد GET است یا نه شخصی‌سازی کنید) اما مواردی که نباید تغییر دهید به شرح زیر است:

### مواردی که نباید تغییر دهید 
+ امضای متد‌های `HttpRequest` را نباید تغییر دهید. چرا که این مورد تست junit را با مشکل مواجه می‌کند. 
+ کارکرد کلی متدهای داده شده در `HttpRequest` را نباید تغییر دهید. مثلا انتظار نمی‌رود ارسال درخواست در متدی به جز `request` انجام شود. البته تغییرات جزئی بلامانع است. 
+ فایل‌های دیگر بسته سورس به جز `HttpRequest` را اصلا نباید تغییر دهید.
+ همچنین دقت داشته باشید اضافه کردن کلاس‌های دیگر به پکیج `main` بلامانع است.

## توجه
همانطور که احتمالا دقت کرده‌اید، بدنه درخواست به شکل map است، برای ارسال بدنه، باید آن را (در صورت وجود) به شکل json تبدیل کنید (فقط با کمک جاوای خام) و ارسال کنید. با توجه به اینکه هم keyها و هم valueها به شکل رشته هستند، کار تبدیل map به json سخت نیست.
برای مثال یک نمونه داده در فرمت json می‌بینیم:
```js
{
	"key1" : "value1",
	"key2" : "value2"
}
```
+ کوئرا از جاوای حداکثر ۸ پشتیبانی می‌کند بنابراین متد `encode` از  `URLEncoder` باید charset را به شکل String دریافت کنید.
```java
result.append(
    URLEncoder.encode(
        entry.getKey(),
        StandardCharsets.UTF_8.toString() // important part
     )
);

```
### توجه 
+ برای متد `GET` لازم است به درستی query parameter ها را تنظیم کنید.
+ برای متدهای غیر از `GET` نباید از query parameter ها استفاده کنید و آن را نادیده بگیرید. در این مورد ارسال body کفایت می‌کند.

### آپلود و داوری 
+ برای نمره‌دهی و ارزیابی این تمرین، از یونیت‌تست‌ استفاده خواهد شد بنابراین اهمیت دارد که امضای متد‌ها هیچ تغییری نکند. 
+ متاسفانه امکان ارسال درخواست و تعامل با بیرون در داوری quera وجود ندارد، بنابراین تست‌ها به صورت محلی انجام خواهند شد و نمره‌دهی توسط quera نخواهد بود.
+ برای اینکه از صحت ارسال خود مطمئن شوید (قالب، و نه کارکرد) تست junit دیگری در کوئرا ترتیب داده شده است. با ارسال کد خود در کوئرا و اتمام داوری، می‌توانید بررسی کنید که آیا کد خود را به صورت صجیج آپلود کرده اید یا حیر.
+ برای آپلود، پوشه‌ی main که حاوی `HttpRequest` و باقی کلاس‌های شماست را زیپ کنید و ارسال کنید. همچنین در صورت بروز مشکل (مثلا `cannot run x tests`) کد را با حالت «اجرا تست نمونه» آپلود کنید.
+ برای نمر‌ه‌دهی، «ارسال نهایی» شما بررسی می‌شود. برای این منظور باید کد نهایی خود را به شکل معمولی ارسال کنید (و نه آزمایشی) و تیک «ارسال نهایی» را به درستی تنظیم کنید.


## نکات نهایی
+ مجددا تکرار می‌شود نمره گرفتن از تست quera اصلا به معنی صحت کارکرد کد شما نیست و نمره‌دهی به صورت جداگانه انجام خواهد شد.
+ استفاده از socket یا HttpUrlConnection بلامانع است.
+ شاید [این لینک](https://www.baeldung.com/httpurlconnection-post#7-create-the-request-body) کمک‌کننده باشد


نکته نهایی: در صورتی که مایل هستید بدانید تستی که در کوئرا اجرا می‌شود چیست، به [این فایل](https://github.com/SBU-CE/IE/blob/main/HW-spring1400/2-http/quera-compile-test/tests/test/SampleTest.java) توجه کنید.
