# طراحی یک API ساده

علیرضا که به تازگی با زبان Golang آشنا شده و به این درس علاقه‌ی زیادی دارد، پس از حل کردن سوالات ابتدایی این تمرین تصمیم به این گرفته که یک API خیلی ساده با امکانات خود زبان طراحی کند که پس از دریافت درخواست کاربر، عملیات درخواستی را انجام داده و نتیجه را خروجی دهد.

علیرضا فقط با استفاده از امکانات خود زبان این پیاده‌سازی را انجام می‌دهد.

----------

این API دو endpoint بیشتر ندارد که در جدول زیر توضیحات هرکدام را مشاهده می‌کنیم:

|   Endpoint   |   Description   |
|:---------------:|:------------:|
|`POST /calculator`|انجام تسک درخواستی با توجه به ورودی‌ها|
|`GET /history`|دریافت تاریخچه‌ی تسک‌های انجام‌شده توسط سرور|

**۱. عملیات محاسبه‌ی تسک (POST):**
کاربر درخواست jsonی شبیه درخواست زیر می‌دهد (ساختار همه‌ی درخواست‌ها یکسان است):

```JSON
// POST /calculator
{
	"task": "mean",
	"numbers": [2, 4, 1, 5, 21]
}
```
و سرور خروجی json زیر را برمی‌گرداند (اگر درخواست معتبر باشد):
```JSON
{
	"task": "mean",
	"numbers": [2, 4, 1, 5, 21],
	"answer": 6.6,
	"code": 200,
	"message": "Task done successfully!"
}
```
تسک‌هایی که سرور باید انجام دهد در جدول زیر آمده است.

|   Task Name   | Answer Type   |   Description   |
|:---------------:|:-------------:|:-------------:|
|`sort`|`[]int`|مرتب‌سازی اعداد ورودی|
|`mean`|`float`|پیدا کردن میانگین اعداد ورودی|

همچنین ساختار درخواست نیز در جدول زیر قابل مشاهده است:

|   Key   |   Type   |   Description   |
|:---------------:|:--------:|:-------:|
|`task`|`string`|نام تسک (یکی از موارد گفته‌شده)|
|`numbers`|`[]int`|لیست اعداد ورودی که تسک باید روی آنها انجام شود.|

**۲. عملیات دریافت تاریخچه‌ی تسک‌ها (GET):**
در این درخواست نیاز به وارد کردن داده نیست و صرفاً با خود درخواست،‌ پاسخی مثل پاسخ زیر از طرف سرور فرستاده می‌شود:
```JSON
{
	"size": 5,
	"history": [
		{
			"task": "mean",
			"numbers": [2, 4, 1, 5, 21],
			"answer": 6.6
		},
		{...},
		{...},
		{...},
		{...}
	],
	"code": 200,
	"message": "History sent successfully!"
}
```
**دقت کنید** که فقط درخواست‌های درست (با کد پاسخ 200) در تاریخچه قرار می‌گیرند.

----------

### نکات
+ ممکن است درخواستی که هنگام استفاده از `POST /calculator` به سرور داده می‌شود مشکلاتی داشته باشد. شما می‌بایست ارورهای رایج را در نظر گرفته و **پیام و کد وضعیت** متناسب هرکدام را به عنوان پاسخ سرور تولید کنید. طبیعی‌ست که اگر درخواست دارای مشکل باشد، پاسخ سرور دارای فیلد `answer` نخواهد بود **و درخواست در تاریخچه قرار نخواهد گرفت**. از ارور‌های رایج می‌توان به موارد زیر اشاره کرد: 
	+ درست نبودن نوع مقادیر ورودی (مثلاً لیستی از floatها) 
	+ آورده شدن تسکی به غیر از تسک‌های گفته‌شده
	+ استفاده کردن از متدی بجز `POST‍` و `GET`
	+ وجود موارد اضافی (علاوه بر تسک و اعداد) در درخواست
	+ اشتباه وارد کردن endpoint (ورودی اشتباه به صورت کلی)
+ در پیاده‌سازی این تمرین فقط و فقط مجاز به استفاده از خود امکانات زبان گو هستید. استفاده از هرگونه فریم‌ورک و کتاب‌خانه‌ی خارجی مثل echo مجاز نیست.
+ پس از پیاده‌سازی، همه کدهای خود را در قالب یک فایل زیپ بارگذاری کنید.
+ در حالت پایه فرض کنید که درخواست‌ها قرار نیست همزمان به سرور شما ارسال شوند و نیازی به هندل کردن هم‌روندی و چنل‌ها نیست.

### امتیازی
واضح‌ است که اینکه انتظار داشته‌ باشیم همزمان فقط یک درخواست به سرور فرستاده‌ شود اندکی غیرواقعی است، در قسمت امتیازی این تمرین از شما می‌خواهیم که به برنامه‌تان قابلیت هندل کردن درخواست‌های همزمان را اضافه کنید. برای این منظور باید از چنل‌ها و گو روتین‌ها استفاده کنید تا از race condition جلوگیری کنید. مطالعه [این مطلب](https://medium.com/dm03514-tech-blog/golang-introduction-to-race-conditions-for-the-web-engineer-738513ab2ec2) هم می‌تواند مفید باشد.
